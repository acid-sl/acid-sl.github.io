---
layout: post
title: "微服务涉及到的名词解释"
description: ""
category:
tags: []
---
{% include JB/setup %}



#### 名词 & 概念

##### 数据库本地事务
> ACID
数据库本地事务四大特性：
-A:原子性(Atomicity)
-C:一致性(Consistency)
-I:隔离性(Isolation)
-D:持久性(Durability)

##### 分布式事务
**CAP**
CAP定理，又叫布鲁尔定理。 指的是针对一个分布式系统，不可能同时满足以下三点： 一致性，可用性以及分区容错性
- C一致性(Consistency)： 指的是强一致性，意思是分布式服务中的每个节点访问同一份最新数据副本。即指在任何一个节点中写入数据，所有节点读取操作返回的值都是写操作的结果。
- A可用性(Availability)： 系统中的非故障节点收到的每个请求都必须有响应。可用性系统中，只要服务器没有整体崩溃，最终都必须响应客户端的请求，否则就是不满足可用性。正常的响应时间返回合理的数据。
- P分区容错性(Partition tolerance)： 容许节点有误差，但是节点之间无论什么原因导致的消息传递差错，都不影响服务的正常提供。

分布式系统中必须要满足P条件，因此只能在CA之间做取舍。

CA之间的矛盾体现在：如果要保证数据的一致性，就需要在同步数据的期间锁定数据，这就导致在同步数据期间，针对客户端的请求，服务端会读取超时或者失败。就不满足可用性。

**BASE**
BASE全称： Basically Available(基本可用), Soft state(软状态), Eventually consistent(最终一致性)
BASE理论是对CAP定理中的可用性和一致性权衡的结果。


**2PC**
即两阶段提交。 分布式事务的两阶段提交是把整个事务的提交分为prepare和commit两个部分。 
![alt 2pc](/assets/images/2pc.png)
第一阶段， 事务协调者会向事务参与者（RM）发送prepare请求， RM返回yes/no给事务协调者。
第二阶段， 事务协调者接收到第一阶段RM发送的请求，全部为yes， 事务协调者再向RM发送commit请求，否则发送rollback。

两阶段提交的3个问题：
1.同步阻塞，第一阶段的prepare会锁住资源，这期间如果有其他事务要修改同一条数据，需要等当前事务执行完。
2.协调节点单点故障， 第一阶段的prepare执行完之后，在发送第二阶段指令之前，协调节点宕机了，会导致事务一直无法提交或回滚，当前事务所占用的资源被锁。事务就会无限期的等待。
3.数据的不一致，还有第一阶段prepare执行成功，第二阶段协调者在发送指令给某个RM时失败了。那么该节点的数据就与其他节点数据不一致

**3PC***
为了解决两阶段提交的问题，3阶段提交引入了：
1.协调节点与事务参与者RM都引入了超时机制。
2.第一阶段的prepare拆分成了canCommit和preCommit
![alt 3pc](/assets/images/3pc.png)
引入 preCommit 阶段后，协调节点会在 commit 之前再次检查各个事务参与者的状态，保证它们的状态是一致的。但是也存在问题，那就是如果第三阶段发出 rollback 请求，有的节点没有收到，那没有收到的节点会在超时之后进行提交，造成数据不一致。
> TCC
> SAGA 事务
> MQ事务